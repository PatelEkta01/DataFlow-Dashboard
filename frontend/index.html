<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DataFlow Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="container">
    <h1>📊 DataFlow Dashboard</h1>

    <!-- Progress indicator -->
    <div class="progress-bar">
      <div class="progress-step active" data-step="1">
        <div class="step-circle">1</div>
        <span>Upload</span>
      </div>
      <div class="progress-step" data-step="2">
        <div class="step-circle">2</div>
        <span>Load</span>
      </div>
      <div class="progress-step" data-step="3">
        <div class="step-circle">3</div>
        <span>Visualize</span>
      </div>
    </div>

    <div class="section">
      <h2>📁 Upload CSV</h2>
      <div class="upload-area" id="uploadArea">
        <div class="upload-content">
          <div class="upload-icon">📄</div>
          <p>Drag & drop your CSV file here or click to browse</p>
          <input type="file" id="fileInput" accept=".csv" hidden>
          <button class="upload-btn" onclick="document.getElementById('fileInput').click()">Choose File</button>
        </div>
        <div class="upload-progress" id="uploadProgress" style="display: none;">
          <div class="progress-circle">
            <div class="progress-fill"></div>
            <span class="progress-text">0%</span>
          </div>
          <p>Processing your file...</p>
        </div>
      </div>
      <div class="file-info" id="fileInfo" style="display: none;"></div>
    </div>

    <div class="section" id="loadSection" style="opacity: 0.5; pointer-events: none;">
      <h2>📊 Load Data</h2>
      <p class="section-description">Load your uploaded data to start creating visualizations</p>
      <button class="primary-btn" onclick="loadData()" id="loadBtn">
        <span class="btn-icon">⚡</span>
        Load Data
      </button>
      <div class="data-preview" id="dataPreview" style="display: none;"></div>
    </div>

    <div class="section" id="chartSection" style="opacity: 0.5; pointer-events: none;">
      <h2>📈 Create Visualization</h2>
      <p class="section-description">Select your data fields and chart type</p>
      
      <div class="chart-controls">
        <div class="control-group">
          <label>Chart Type</label>
          <select id="chartType">
            <option value="bar">📊 Bar Chart</option>
            <option value="line">📈 Line Chart</option>
            <option value="pie">🥧 Pie Chart</option>
            <option value="scatter">⚪ Scatter Plot</option>
          </select>
        </div>
        
        <div class="control-group">
          <label>X-Axis</label>
          <select id="xField">
            <option value="">Select field...</option>
          </select>
        </div>
        
        <div class="control-group">
          <label>Y-Axis</label>
          <select id="yField">
            <option value="">Select field...</option>
          </select>
        </div>
        
        <button class="primary-btn" onclick="drawChart()" id="drawBtn">
          <span class="btn-icon">🎨</span>
          Create Chart
        </button>
      </div>
    </div>

    <div class="section" id="visualSection" style="display: none;">
      <div class="chart-header">
        <h2>📊 Your Visualization</h2>
        <div class="chart-actions">
          <button class="secondary-btn" onclick="downloadChart()">💾 Save Chart</button>
          <button class="secondary-btn" onclick="resetChart()">🔄 Reset</button>
        </div>
      </div>
      <div class="chart-container">
        <canvas id="chartCanvas"></canvas>
      </div>
    </div>

    <div class="section" id="summarySection" style="display: none;">
      <h2>📋 Data Summary</h2>
      <div id="summary"></div>
    </div>

    <div class="section" id="aiSection" style="display: none;">
      <h2>🧠 AI Assistant</h2>
      <p class="section-description">Ask questions about your data in natural language</p>
      
      <div class="ai-input-container">
        <div class="suggested-questions">
          <span class="suggest-label">Try asking:</span>
          <button class="suggestion-chip" onclick="setQuery('What is the highest value?')">What is the highest value?</button>
          <button class="suggestion-chip" onclick="setQuery('Show me the average')">Show me the average</button>
          <button class="suggestion-chip" onclick="setQuery('Which category has the most records?')">Which category has the most records?</button>
        </div>
        
        <div class="query-input-group">
          <input id="queryInput" type="text" placeholder="Ask anything about your data..." maxlength="200">
          <button class="ai-btn" onclick="askAI()" id="aiBtn">
            <span class="btn-icon">🤖</span>
            Ask AI
          </button>
        </div>
        
        <div class="character-count">
          <span id="charCount">0</span>/200
        </div>
      </div>
      
      <div id="aiAnswer" style="display: none;"></div>
    </div>
  </div>

  <script>
    const apiEndpoint = "https://p4qqt7ydgi.execute-api.us-east-1.amazonaws.com/prod/get-data";
    const uploadBucket = "dataflow-dashboard-uploads";
    let globalData = [];
    let currentStep = 1;

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      setupDragAndDrop();
      setupInputListeners();
      updateProgress();
    });

    function setupDragAndDrop() {
      const uploadArea = document.getElementById('uploadArea');
      const fileInput = document.getElementById('fileInput');

      uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.classList.add('drag-over');
      });

      uploadArea.addEventListener('dragleave', () => {
        uploadArea.classList.remove('drag-over');
      });

      uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('drag-over');
        const files = e.dataTransfer.files;
        if (files.length > 0 && files[0].type === 'text/csv') {
          fileInput.files = files;
          uploadFile();
        } else {
          showNotification('Please drop a CSV file', 'error');
        }
      });

      fileInput.addEventListener('change', uploadFile);
    }

    function setupInputListeners() {
      const queryInput = document.getElementById('queryInput');
      const charCount = document.getElementById('charCount');
      
      queryInput.addEventListener('input', function() {
        charCount.textContent = this.value.length;
        if (this.value.length > 180) {
          charCount.style.color = '#ff6b6b';
        } else {
          charCount.style.color = '#a0aec0';
        }
      });

      queryInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          askAI();
        }
      });
    }

    function updateProgress() {
      const steps = document.querySelectorAll('.progress-step');
      steps.forEach((step, index) => {
        if (index + 1 <= currentStep) {
          step.classList.add('active');
        } else {
          step.classList.remove('active');
        }
      });
    }

    function enableSection(sectionId) {
      const section = document.getElementById(sectionId);
      section.style.opacity = '1';
      section.style.pointerEvents = 'auto';
      section.style.transform = 'translateY(0)';
    }

    function showSection(sectionId) {
      const section = document.getElementById(sectionId);
      section.style.display = 'block';
      setTimeout(() => {
        section.style.opacity = '1';
        section.style.transform = 'translateY(0)';
      }, 100);
    }

    function showNotification(message, type = 'success') {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.innerHTML = `
        <span>${message}</span>
        <button onclick="this.parentElement.remove()">×</button>
      `;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.classList.add('show');
      }, 100);
      
      setTimeout(() => {
        notification.remove();
      }, 5000);
    }

    async function uploadFile() {
      const file = document.getElementById("fileInput").files[0];
      if (!file) return;

      if (!file.name.toLowerCase().endsWith('.csv')) {
        showNotification('Please select a CSV file', 'error');
        return;
      }

      const uploadArea = document.getElementById('uploadArea');
      const uploadProgress = document.getElementById('uploadProgress');
      const fileInfo = document.getElementById('fileInfo');
      
      uploadArea.querySelector('.upload-content').style.display = 'none';
      uploadProgress.style.display = 'flex';

      // Simulate upload progress
      let progress = 0;
      const progressInterval = setInterval(() => {
        progress += Math.random() * 30;
        if (progress > 90) progress = 90;
        
        const progressFill = document.querySelector('.progress-fill');
        const progressText = document.querySelector('.progress-text');
        progressFill.style.width = progress + '%';
        progressText.textContent = Math.round(progress) + '%';
      }, 200);

      try {
        globalData = [];
        const uploadUrl = `https://${uploadBucket}.s3.amazonaws.com/${file.name}`;

        await fetch(uploadUrl, {
          method: "PUT",
          headers: { "Content-Type": "text/csv" },
          body: file,
        });

        clearInterval(progressInterval);
        document.querySelector('.progress-fill').style.width = '100%';
        document.querySelector('.progress-text').textContent = '100%';

        setTimeout(() => {
          uploadProgress.style.display = 'none';
          fileInfo.style.display = 'block';
          fileInfo.innerHTML = `
            <div class="file-success">
              <span class="success-icon">✅</span>
              <div>
                <strong>${file.name}</strong>
                <p>Size: ${(file.size / 1024).toFixed(1)} KB • Uploaded successfully</p>
              </div>
            </div>
          `;
          
          currentStep = 2;
          updateProgress();
          enableSection('loadSection');
          showNotification('File uploaded successfully!');
        }, 1000);

      } catch (error) {
        clearInterval(progressInterval);
        uploadProgress.style.display = 'none';
        uploadArea.querySelector('.upload-content').style.display = 'flex';
        showNotification('Upload failed. Please try again.', 'error');
      }
    }

    async function loadData() {
      const loadBtn = document.getElementById('loadBtn');
      const originalText = loadBtn.innerHTML;
      loadBtn.innerHTML = '<span class="btn-icon loading">⏳</span>Loading...';
      loadBtn.disabled = true;

      try {
        const res = await fetch(`${apiEndpoint}?t=${Date.now()}`);
        globalData = await res.json();

        if (!Array.isArray(globalData) || globalData.length === 0) {
          showNotification('No data found. Please upload a file first.', 'error');
          return;
        }

        const sample = globalData[0];
        const ignoredFields = ["record_id", "file_name", "upload_time", "etl_notes"];
        const keys = Object.keys(sample).filter(k => !ignoredFields.includes(k));

        const xSel = document.getElementById("xField");
        const ySel = document.getElementById("yField");
        xSel.innerHTML = '<option value="">Select field...</option>';
        ySel.innerHTML = '<option value="">Select field...</option>';

        keys.forEach(k => {
          const optX = document.createElement("option");
          optX.value = k;
          optX.text = k;
          xSel.appendChild(optX);

          const optY = document.createElement("option");
          optY.value = k;
          optY.text = k;
          ySel.appendChild(optY);
        });

        // Show data preview
        const preview = document.getElementById('dataPreview');
        preview.style.display = 'block';
        preview.innerHTML = `
          <div class="preview-header">
            <h4>📋 Data Preview</h4>
            <span class="record-count">${globalData.length} records</span>
          </div>
          <div class="preview-table">
            <table>
              <thead>
                <tr>${keys.map(k => `<th>${k}</th>`).join('')}</tr>
              </thead>
              <tbody>
                ${globalData.slice(0, 3).map(row => 
                  `<tr>${keys.map(k => `<td>${row[k]}</td>`).join('')}</tr>`
                ).join('')}
              </tbody>
            </table>
            ${globalData.length > 3 ? `<p class="preview-note">Showing first 3 of ${globalData.length} records</p>` : ''}
          </div>
        `;

        currentStep = 3;
        updateProgress();
        enableSection('chartSection');
        showNotification(`Loaded ${globalData.length} records successfully!`);

      } catch (error) {
        showNotification('Failed to load data. Please try again.', 'error');
      } finally {
        loadBtn.innerHTML = originalText;
        loadBtn.disabled = false;
      }
    }

    function drawChart() {
      const xField = document.getElementById("xField").value;
      const yField = document.getElementById("yField").value;
      const chartType = document.getElementById("chartType").value;

      if (!xField || !yField) {
        showNotification('Please select both X and Y fields', 'error');
        return;
      }

      if (!globalData.length) {
        showNotification('No data loaded. Please load data first.', 'error');
        return;
      }

      const drawBtn = document.getElementById('drawBtn');
      const originalText = drawBtn.innerHTML;
      drawBtn.innerHTML = '<span class="btn-icon loading">⏳</span>Creating...';
      drawBtn.disabled = true;

      setTimeout(() => {
        try {
          createVisualization(xField, yField, chartType);
          showSection('visualSection');
          showSection('summarySection');
          showSection('aiSection');
          showNotification('Chart created successfully!');
        } catch (error) {
          showNotification('Failed to create chart. Please try different fields.', 'error');
        } finally {
          drawBtn.innerHTML = originalText;
          drawBtn.disabled = false;
        }
      }, 500);
    }

    function createVisualization(xField, yField, chartType) {
      const labels = globalData.map(d => d[xField]);
      const values = globalData.map(d => {
        const num = parseFloat(d[yField]);
        return isNaN(num) ? null : num;
      });

      const cleanedLabels = [];
      const cleanedValues = [];
      for (let i = 0; i < values.length; i++) {
        if (values[i] !== null) {
          cleanedLabels.push(labels[i]);
          cleanedValues.push(values[i]);
        }
      }

      if (cleanedValues.length === 0) {
        throw new Error('Selected Y-axis field is not numeric');
      }

      const ctx = document.getElementById("chartCanvas").getContext("2d");
      if (window.chartInstance) window.chartInstance.destroy();

      const chartConfig = {
        type: chartType,
        data: {
          labels: cleanedLabels,
          datasets: [{
            label: `${yField} by ${xField}`,
            data: cleanedValues,
            backgroundColor: chartType === 'pie' ? 
              generateColors(cleanedValues.length) : 
              'rgba(0, 212, 170, 0.8)',
            borderColor: chartType === 'pie' ? 
              generateColors(cleanedValues.length, true) : 
              '#00b894',
            borderWidth: 2,
            tension: chartType === 'line' ? 0.4 : 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              labels: { color: '#a0aec0' },
              display: chartType === 'pie'
            },
            tooltip: {
              backgroundColor: 'rgba(30, 30, 30, 0.9)',
              titleColor: '#00d4aa',
              bodyColor: '#e2e8f0',
              borderColor: '#00d4aa',
              borderWidth: 1
            }
          },
          scales: chartType !== 'pie' ? {
            y: { 
              beginAtZero: true,
              ticks: { color: '#a0aec0' },
              grid: { color: 'rgba(45, 55, 72, 0.5)' }
            },
            x: {
              ticks: { color: '#a0aec0' },
              grid: { color: 'rgba(45, 55, 72, 0.5)' }
            }
          } : {}
        }
      };

      window.chartInstance = new Chart(ctx, chartConfig);
      generateSummary(cleanedLabels, cleanedValues, xField, yField);
    }

    function generateColors(count, border = false) {
      const colors = [
        '#00d4aa', '#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', 
        '#fcea2b', '#ff9ff3', '#54a0ff', '#ee5a24', '#00d2d3'
      ];
      
      return Array.from({length: count}, (_, i) => {
        const color = colors[i % colors.length];
        return border ? color : color + (border ? '' : '80');
      });
    }

    function generateSummary(labels, values, xField, yField) {
      const summaryEl = document.getElementById("summary");
      
      const stats = {
        totalRecords: values.length,
        uniqueX: [...new Set(labels)].length,
        yMin: Math.min(...values),
        yMax: Math.max(...values),
        yAvg: values.reduce((a, b) => a + b, 0) / values.length
      };

      let bestLabel = null, bestAvg = -Infinity;
      let worstLabel = null, worstAvg = Infinity;

      const groupStats = {};
      for (let i = 0; i < labels.length; i++) {
        const label = labels[i];
        const value = values[i];
        if (!groupStats[label]) groupStats[label] = { total: 0, count: 0 };
        groupStats[label].total += value;
        groupStats[label].count += 1;
      }

      for (const label in groupStats) {
        const avg = groupStats[label].total / groupStats[label].count;
        if (avg > bestAvg) { bestAvg = avg; bestLabel = label; }
        if (avg < worstAvg) { worstAvg = avg; worstLabel = label; }
      }

      summaryEl.innerHTML = `
        <div class="summary-grid">
          <div class="summary-card">
            <div class="summary-icon">📊</div>
            <div>
              <h4>Total Records</h4>
              <p>${stats.totalRecords}</p>
            </div>
          </div>
          <div class="summary-card">
            <div class="summary-icon">📈</div>
            <div>
              <h4>Average ${yField}</h4>
              <p>${stats.yAvg.toFixed(2)}</p>
            </div>
          </div>
          <div class="summary-card">
            <div class="summary-icon">🏆</div>
            <div>
              <h4>Highest</h4>
              <p>${bestLabel} (${bestAvg.toFixed(2)})</p>
            </div>
          </div>
          <div class="summary-card">
            <div class="summary-icon">📉</div>
            <div>
              <h4>Range</h4>
              <p>${stats.yMin.toFixed(2)} - ${stats.yMax.toFixed(2)}</p>
            </div>
          </div>
        </div>
      `;
    }

    function setQuery(query) {
      document.getElementById('queryInput').value = query;
      document.getElementById('charCount').textContent = query.length;
    }

    function downloadChart() {
      if (window.chartInstance) {
        const link = document.createElement('a');
        link.download = 'dataflow-chart.png';
        link.href = window.chartInstance.toBase64Image();
        link.click();
        showNotification('Chart saved successfully!');
      }
    }

    function resetChart() {
      if (window.chartInstance) {
        window.chartInstance.destroy();
        window.chartInstance = null;
      }
      document.getElementById('visualSection').style.display = 'none';
      document.getElementById('summarySection').style.display = 'none';
      document.getElementById('aiSection').style.display = 'none';
      document.getElementById('xField').value = '';
      document.getElementById('yField').value = '';
      showNotification('Chart reset successfully!');
    }

    // AI functionality (keeping original logic)
    const HF_TOKEN = "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";

    function analyzeDataLocally(prompt) {
      const lowerPrompt = prompt.toLowerCase();

      if (!globalData || globalData.length === 0) {
        return "Please load data first.";
      }

      const sample = globalData[0];
      const numericColumns = Object.keys(sample).filter(key => {
        return !isNaN(parseFloat(sample[key])) && key !== 'record_id' && key !== 'upload_time';
      });

      if (lowerPrompt.includes('highest') || lowerPrompt.includes('maximum') || lowerPrompt.includes('max')) {
        let messages = [];
        numericColumns.forEach(col => {
          const values = globalData.map(row => parseFloat(row[col])).filter(v => !isNaN(v));
          if (values.length > 0) {
            const maxValue = Math.max(...values);
            const maxRow = globalData.find(row => parseFloat(row[col]) === maxValue);
            const identifiers = Object.keys(maxRow).filter(key => 
              isNaN(parseFloat(maxRow[key])) && key !== 'record_id' && key !== 'upload_time' && key !== 'file_name'
            );
            let identifierText = '';
            if (identifiers.length > 0) {
              identifierText = identifiers.map(id => `${id}: ${maxRow[id]}`).join(', ');
            }
            messages.push(`🔺 The highest <strong>${col}</strong> is <strong>${maxValue}</strong>${identifierText ? ` — ${identifierText}` : ''}.`);
          }
        });
        return messages.join("<br>") || 'No numeric fields found.';
      }

      if (lowerPrompt.includes('lowest') || lowerPrompt.includes('minimum') || lowerPrompt.includes('min')) {
        let messages = [];
        numericColumns.forEach(col => {
          const values = globalData.map(row => parseFloat(row[col])).filter(v => !isNaN(v));
          if (values.length > 0) {
            const minValue = Math.min(...values);
            const minRow = globalData.find(row => parseFloat(row[col]) === minValue);
            const identifiers = Object.keys(minRow).filter(key => 
              isNaN(parseFloat(minRow[key])) && key !== 'record_id' && key !== 'upload_time' && key !== 'file_name'
            );
            let identifierText = '';
            if (identifiers.length > 0) {
              identifierText = identifiers.map(id => `${id}: ${minRow[id]}`).join(', ');
            }
            messages.push(`🔻 The lowest <strong>${col}</strong> is <strong>${minValue}</strong>${identifierText ? ` — ${identifierText}` : ''}.`);
          }
        });
        return messages.join("<br>") || 'No numeric fields found.';
      }

      if (lowerPrompt.includes('average') || lowerPrompt.includes('mean')) {
        let messages = [];
        numericColumns.forEach(col => {
          const values = globalData.map(row => parseFloat(row[col])).filter(v => !isNaN(v));
          if (values.length > 0) {
            const avg = values.reduce((a, b) => a + b, 0) / values.length;
            messages.push(`📊 The average <strong>${col}</strong> is <strong>${avg.toFixed(2)}</strong>.`);
          }
        });
        return messages.join("<br>") || 'No numeric fields found.';
      }

      if (lowerPrompt.includes('count') || lowerPrompt.includes('total')) {
        return `📦 Total records in this dataset: <strong>${globalData.length}</strong>`;
      }

      const columns = Object.keys(globalData[0]).filter(key => 
        key !== 'record_id' && key !== 'upload_time' && key !== 'file_name'
      );
      
      return `🤖 I can answer questions like:
        <br>• "What is the highest [column name]?"
        <br>• "What is the lowest [column name]?"
        <br>• "What is the average [column name]?"
        <br>• "How many records are there?"
        <br><br>Available columns: <strong>${columns.join(', ')}</strong>`;
    }

    async function askAI() {
      const prompt = document.getElementById("queryInput").value.trim();
      const answerEl = document.getElementById("aiAnswer");
      const aiBtn = document.getElementById("aiBtn");
      
      if (!prompt) {
        showNotification('Please type a question', 'error');
        return;
      }

      if (!globalData || globalData.length === 0) {
        showNotification('Please load data first', 'error');
        return;
      }

      answerEl.style.display = 'block';
      answerEl.innerHTML = `
        <div class="ai-thinking">
          <div class="thinking-dots">
            <span></span><span></span><span></span>
          </div>
          <p>Analyzing your data...</p>
        </div>
      `;
      
      aiBtn.innerHTML = '<span class="btn-icon loading">⏳</span>Thinking...';
      aiBtn.disabled = true;

      try {
        const response = await fetch("#modelinfo", {
          method: "POST",
          headers: {
            "Authorization": `Bearer ${HF_TOKEN}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ 
            inputs: `Answer this question about the data: ${prompt}. Data sample: ${JSON.stringify(globalData[0])}`,
            parameters: { max_length: 50 }
          })
        });

        if (response.ok) {
          const result = await response.json();
          if (result && result[0] && result[0].generated_text) {
            answerEl.innerHTML = `
              <div class="ai-response">
                <div class="ai-header">
                  <span class="ai-icon">🤖</span>
                  <strong>AI Analysis</strong>
                </div>
                <p>${result[0].generated_text}</p>
              </div>
            `;
            return;
          }
        }
      } catch (err) {
        console.error("AI model error:", err);
      }

      // Fallback to local analysis
      const localResult = analyzeDataLocally(prompt);
      answerEl.innerHTML = `
        <div class="ai-response">
          <div class="ai-header">
            <span class="ai-icon">🤖</span>
            <strong>Data Analysis</strong>
          </div>
          <div>${localResult}</div>
        </div>
      `;

      aiBtn.innerHTML = '<span class="btn-icon">🤖</span>Ask AI';
      aiBtn.disabled = false;
    }
  </script>

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
  color: #e2e8f0;
  line-height: 1.6;
  min-height: 100vh;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
}

h1 {
  text-align: center;
  margin-bottom: 2rem;
  font-size: 2.5rem;
  color: #00d4aa;
  text-shadow: 0 0 20px rgba(0, 212, 170, 0.3);
  font-weight: 700;
  animation: glow 3s ease-in-out infinite;
}

/* Progress Bar */
.progress-bar {
  display: flex;
  justify-content: center;
  align-items: center;
  margin-bottom: 3rem;
  position: relative;
}

.progress-bar::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 20%;
  right: 20%;
  height: 2px;
  background: rgba(0, 212, 170, 0.2);
  z-index: 1;
}

.progress-step {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.5rem;
  z-index: 2;
  position: relative;
}

.step-circle {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: rgba(45, 55, 72, 0.8);
  color: #a0aec0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  transition: all 0.3s ease;
  border: 2px solid rgba(0, 212, 170, 0.3);
}

.progress-step.active .step-circle {
  background: linear-gradient(135deg, #00d4aa 0%, #00b894 100%);
  color: #1a1a1a;
  border-color: #00d4aa;
  box-shadow: 0 0 20px rgba(0, 212, 170, 0.4);
}

.progress-step span {
  font-size: 0.85rem;
  color: #a0aec0;
  font-weight: 500;
}

.progress-step.active span {
  color: #00d4aa;
}

.section {
  background: rgba(30, 30, 30, 0.95);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(0, 212, 170, 0.1);
  padding: 2rem;
  margin-bottom: 2rem;
  border-radius: 16px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
  transition: all 0.5s ease;
  transform: translateY(10px);
  opacity: 0;
  animation: slideIn 0.6s ease forwards;
}

@keyframes slideIn {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.section:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.5);
  border-color: rgba(0, 212, 170, 0.2);
}

h2 {
  margin-bottom: 1rem;
  font-size: 1.4rem;
  color: #00d4aa;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.section-description {
  color: #a0aec0;
  margin-bottom: 1.5rem;
  font-size: 0.95rem;
}

/* Upload Area */
.upload-area {
  border: 2px dashed rgba(0, 212, 170, 0.3);
  border-radius: 12px;
  padding: 3rem 2rem;
  text-align: center;
  transition: all 0.3s ease;
  background: rgba(20, 20, 20, 0.3);
  position: relative;
  overflow: hidden;
}

.upload-area::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(0, 212, 170, 0.1), transparent);
  transition: left 0.5s ease;
}

.upload-area:hover::before {
  left: 100%;
}

.upload-area:hover {
  border-color: rgba(0, 212, 170, 0.5);
  background: rgba(0, 212, 170, 0.05);
}

.upload-area.drag-over {
  border-color: #00d4aa;
  background: rgba(0, 212, 170, 0.1);
  transform: scale(1.02);
}

.upload-content {
  position: relative;
  z-index: 2;
}

.upload-icon {
  font-size: 3rem;
  margin-bottom: 1rem;
  display: block;
}

.upload-progress {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1rem;
}

.progress-circle {
  position: relative;
  width: 80px;
  height: 80px;
  border-radius: 50%;
  background: conic-gradient(#00d4aa 0deg, rgba(0, 212, 170, 0.2) 0deg);
  display: flex;
  align-items: center;
  justify-content: center;
}

.progress-fill {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border-radius: 50%;
  background: conic-gradient(#00d4aa 0deg, rgba(0, 212, 170, 0.2) 0deg);
  transition: all 0.3s ease;
}

.progress-text {
  position: relative;
  z-index: 3;
  font-weight: 600;
  color: #00d4aa;
}

.upload-btn, .primary-btn, .secondary-btn, .ai-btn {
  background: linear-gradient(135deg, #00d4aa 0%, #00b894 100%);
  color: #1a1a1a;
  border: none;
  padding: 0.75rem 1.5rem;
  border-radius: 10px;
  cursor: pointer;
  font-size: 1rem;
  font-weight: 600;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(0, 212, 170, 0.2);
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  text-decoration: none;
  position: relative;
  overflow: hidden;
}

.upload-btn::before, .primary-btn::before, .secondary-btn::before, .ai-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: left 0.5s ease;
}

.upload-btn:hover::before, .primary-btn:hover::before, .secondary-btn:hover::before, .ai-btn:hover::before {
  left: 100%;
}

.upload-btn:hover, .primary-btn:hover, .secondary-btn:hover, .ai-btn:hover {
  background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(0, 212, 170, 0.3);
}

.secondary-btn {
  background: rgba(45, 55, 72, 0.8);
  color: #e2e8f0;
  border: 1px solid rgba(0, 212, 170, 0.3);
}

.secondary-btn:hover {
  background: rgba(0, 212, 170, 0.1);
  border-color: rgba(0, 212, 170, 0.5);
}

.upload-btn:disabled, .primary-btn:disabled, .ai-btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none;
}

.btn-icon {
  font-size: 1.1rem;
}

.btn-icon.loading {
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.file-info {
  margin-top: 1rem;
}

.file-success {
  display: flex;
  align-items: center;
  gap: 1rem;
  background: rgba(0, 212, 170, 0.1);
  padding: 1rem;
  border-radius: 8px;
  border: 1px solid rgba(0, 212, 170, 0.3);
}

.success-icon {
  font-size: 1.5rem;
}

/* Data Preview */
.data-preview {
  margin-top: 1.5rem;
  animation: fadeIn 0.5s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.preview-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.preview-header h4 {
  color: #00d4aa;
  font-size: 1.1rem;
}

.record-count {
  background: rgba(0, 212, 170, 0.2);
  color: #00d4aa;
  padding: 0.25rem 0.75rem;
  border-radius: 20px;
  font-size: 0.85rem;
  font-weight: 600;
}

.preview-table {
  background: rgba(20, 20, 20, 0.5);
  border-radius: 8px;
  overflow: hidden;
  border: 1px solid rgba(0, 212, 170, 0.1);
}

.preview-table table {
  width: 100%;
  border-collapse: collapse;
}

.preview-table th {
  background: rgba(0, 212, 170, 0.1);
  color: #00d4aa;
  padding: 0.75rem;
  font-weight: 600;
  text-align: left;
  border-bottom: 1px solid rgba(0, 212, 170, 0.2);
}

.preview-table td {
  padding: 0.75rem;
  border-bottom: 1px solid rgba(45, 55, 72, 0.3);
  color: #cbd5e0;
}

.preview-note {
  padding: 0.75rem;
  color: #a0aec0;
  font-size: 0.85rem;
  text-align: center;
  background: rgba(20, 20, 20, 0.3);
}

/* Chart Controls */
.chart-controls {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1.5rem;
  align-items: end;
}

.control-group {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

label {
  font-weight: 500;
  font-size: 0.9rem;
  color: #a0aec0;
}

select {
  padding: 0.75rem;
  border: 1px solid rgba(0, 212, 170, 0.3);
  border-radius: 8px;
  font-size: 1rem;
  background: rgba(45, 55, 72, 0.8);
  color: #e2e8f0;
  transition: all 0.3s ease;
}

select:focus {
  outline: none;
  border-color: rgba(0, 212, 170, 0.7);
  box-shadow: 0 0 0 3px rgba(0, 212, 170, 0.1);
}

select option {
  background: #2d3748;
  color: #e2e8f0;
}

/* Chart Section */
.chart-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
}

.chart-actions {
  display: flex;
  gap: 1rem;
}

.chart-container {
  background: rgba(20, 20, 20, 0.5);
  border-radius: 12px;
  padding: 1.5rem;
  border: 1px solid rgba(0, 212, 170, 0.1);
}

canvas {
  max-width: 100%;
  height: 400px !important;
  border-radius: 8px;
}

/* Summary Cards */
.summary-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1.5rem;
}

.summary-card {
  background: rgba(20, 20, 20, 0.6);
  padding: 1.5rem;
  border-radius: 12px;
  border: 1px solid rgba(0, 212, 170, 0.1);
  display: flex;
  align-items: center;
  gap: 1rem;
  transition: all 0.3s ease;
}

.summary-card:hover {
  transform: translateY(-2px);
  border-color: rgba(0, 212, 170, 0.3);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
}

.summary-icon {
  font-size: 2rem;
  opacity: 0.8;
}

.summary-card h4 {
  color: #a0aec0;
  font-size: 0.9rem;
  margin-bottom: 0.25rem;
}

.summary-card p {
  color: #00d4aa;
  font-size: 1.25rem;
  font-weight: 600;
}

/* AI Section */
.ai-input-container {
  background: rgba(20, 20, 20, 0.3);
  border-radius: 12px;
  padding: 1.5rem;
  border: 1px solid rgba(0, 212, 170, 0.1);
}

.suggested-questions {
  margin-bottom: 1.5rem;
}

.suggest-label {
  color: #a0aec0;
  font-size: 0.9rem;
  margin-bottom: 0.75rem;
  display: block;
}

.suggestion-chip {
  background: rgba(0, 212, 170, 0.1);
  color: #00d4aa;
  border: 1px solid rgba(0, 212, 170, 0.3);
  padding: 0.5rem 1rem;
  border-radius: 20px;
  font-size: 0.85rem;
  margin: 0.25rem 0.5rem 0.25rem 0;
  cursor: pointer;
  transition: all 0.3s ease;
}

.suggestion-chip:hover {
  background: rgba(0, 212, 170, 0.2);
  border-color: rgba(0, 212, 170, 0.5);
  transform: translateY(-1px);
}

.query-input-group {
  display: flex;
  gap: 1rem;
  margin-bottom: 0.5rem;
}

.query-input-group input {
  flex: 1;
  padding: 0.75rem;
  background: rgba(45, 55, 72, 0.8);
  border: 1px solid rgba(0, 212, 170, 0.3);
  border-radius: 8px;
  color: #e2e8f0;
  font-size: 1rem;
  transition: all 0.3s ease;
}

.query-input-group input:focus {
  outline: none;
  border-color: rgba(0, 212, 170, 0.7);
  box-shadow: 0 0 0 3px rgba(0, 212, 170, 0.1);
}

.query-input-group input::placeholder {
  color: #718096;
}

.character-count {
  text-align: right;
  font-size: 0.8rem;
  color: #a0aec0;
}

#aiAnswer {
  background: rgba(20, 20, 20, 0.6);
  border-radius: 12px;
  border: 1px solid rgba(0, 212, 170, 0.2);
  overflow: hidden;
  animation: slideDown 0.5s ease;
}

@keyframes slideDown {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}

.ai-thinking {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 1.5rem;
}

.thinking-dots {
  display: flex;
  gap: 0.25rem;
}

.thinking-dots span {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: #00d4aa;
  animation: dot-pulse 1.5s ease-in-out infinite;
}

.thinking-dots span:nth-child(2) {
  animation-delay: 0.2s;
}

.thinking-dots span:nth-child(3) {
  animation-delay: 0.4s;
}

@keyframes dot-pulse {
  0%, 80%, 100% { opacity: 0.3; transform: scale(0.8); }
  40% { opacity: 1; transform: scale(1); }
}

.ai-response {
  padding: 1.5rem;
}

.ai-header {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 1rem;
  color: #00d4aa;
}

.ai-icon {
  font-size: 1.2rem;
}

.ai-response p, .ai-response div {
  color: #e2e8f0;
  line-height: 1.6;
}

.ai-response strong {
  color: #00d4aa;
}

/* Notifications */
.notification {
  position: fixed;
  top: 20px;
  right: 20px;
  background: rgba(30, 30, 30, 0.95);
  border: 1px solid rgba(0, 212, 170, 0.3);
  border-radius: 8px;
  padding: 1rem 1.5rem;
  color: #e2e8f0;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  z-index: 1000;
  transform: translateX(100%);
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 1rem;
  max-width: 400px;
}

.notification.show {
  transform: translateX(0);
}

.notification.success {
  border-left: 4px solid #01bd97;
}

.notification.error {
  border-left: 4px solid #ff6b6b;
}

.notification button {
  background: none;
  border: none;
  color: #a0aec0;
  font-size: 1.2rem;
  cursor: pointer;
  padding: 0;
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.notification button:hover {
  color: #e2e8f0;
}

/* Animations */
@keyframes glow {
  0%, 100% { text-shadow: 0 0 20px rgba(0, 212, 170, 0.3); }
  50% { text-shadow: 0 0 30px rgba(0, 212, 170, 0.5); }
}

/* Responsive Design */
@media (max-width: 768px) {
  .container {
    padding: 1rem;
  }
  
  h1 {
    font-size: 2rem;
  }
  
  .section {
    padding: 1.5rem;
  }
  
  .chart-controls {
    grid-template-columns: 1fr;
  }
  
  .chart-header {
    flex-direction: column;
    gap: 1rem;
    align-items: stretch;
  }
  
  .chart-actions {
    justify-content: center;
  }
  
  .summary-grid {
    grid-template-columns: 1fr;
  }
  
  .query-input-group {
    flex-direction: column;
  }
  
  .progress-bar {
    flex-direction: column;
    gap: 1rem;
  }
  
  .progress-bar::before {
    display: none;
  }
  
  .notification {
    right: 10px;
    left: 10px;
    max-width: none;
  }
}

/* Scrollbar Styling */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(30, 30, 30, 0.5);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(0, 212, 170, 0.5);
  border-radius: 4px;
  transition: background 0.3s ease;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(0, 212, 170, 0.7);
}